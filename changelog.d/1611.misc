Refactors: Reduce use of Bluebird, increase explicit types, use safer loops.